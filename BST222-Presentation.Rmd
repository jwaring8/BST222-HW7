---
title: "BST 222 Homework 7"
author: "Jonathan Waring, Selena Huang, Laura Levin-Gleba, Wenze Tang"
date: "November 12, 2018"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Exponential Distribution

- The **exponential distribution** is the probability distribution that describes the time between events in a Poisson point process. 
- Exponential variables can be used to model situations where certain events occur with a constant probability per unit length, such as the distance between mutations on a DNA strand
- The probability density function (PDF) of an exponential distribution is given by $$f(x; \lambda) = \begin{cases}\lambda e^{-\lambda x} & x \geq 0 \\ 0 & x < 0 \end{cases}$$ where $\lambda > 0$ is the parameter of the distribution, often called the *rate parameter*

## Exponential PDF

```{r PDF}
library(ggplot2)
library(plyr)
library(latex2exp)
theme_set(theme_bw())

exponential <- function(lambda, x) {
  data.frame(x = x, value = lambda * exp(-lambda * x))
}

params <- expand.grid(lambda = c(0.5, 1, 1.5, 2))
pdfs <- mdply(params, exponential, x = seq(0,4, length=250))
ggplot(pdfs, aes(x, value, color=factor(lambda))) +
  geom_path() + 
  ylab(TeX("$f(x; \\lambda) = \\lambda e^{-\\lambda x} $")) + 
  labs(color=TeX("$\\lambda$"))
```

## Properties of $X \sim Exp(\lambda)$

- The **expected value** of  $X$ is given by $$E[X] = \frac{1}{\lambda}$$
- The **variance** of $X$ is given by $$Var[X] = \frac{1}{\lambda^2}$$
- The **median** of $X$ is given by $$m[X] = \frac{\ln (2)}{\lambda}$$

## Point Estimates of $\lambda$

Point estimation involves the use of sample data to calculate a single value which is to serve as a "best estimate" of an unknown population parameter. In the case of the exponential distribution, we are estimating the rate parameter, $\lambda$. We will use the following three point estimators: 

- Maximum Likelihood Estimator (MLE) 
- 2nd Method of Moments Estimator
- Median as a function of $\lambda$

We will compare these estimators based on the following criteria: 

- Bias
- Mean Squared Error (MSE)
- Consistiency 

## MLE

The MLE for the exponential distribution can be derived as follows: $$L(\lambda ; x_1, ..., x_n) = \prod_{i=1}^{n} \lambda e^{-\lambda x_i} = \lambda^n e^{-\lambda \sum_{i=1}^{n} x_i}$$ $$\ell(\lambda ; x_1, ..., x_n) = \log (\lambda^n) + \log (e^{-\lambda \sum_{i=1}^{n} x_i}) = n \log(\lambda) - \lambda \sum_{i=1}^{n} x_i$$ $$U(\lambda) = \ell '(\lambda ; x_1, ..., x_n) = \frac{n}{\lambda} - \sum_{i=1}^{n} x_i$$ $$\hat{\lambda} = \frac{n}{\sum_{i=1}^{n} x_i} = \frac{1}{\bar{x}}$$

## MLE Bias and Mean Squared Error
The MLE for the exponential distribution can be shown to be asymptotically unbiased given that: $$Bias[\hat{\lambda}] = E[\hat{\lambda}] - \lambda = nE[\frac{1}{\sum_{i=1}^n x_i}] - \lambda = \frac{n \lambda}{n-1} - \lambda = \frac{\lambda}{n-1}$$ which approaches 0 as $n \rightarrow \infty$. The variance of the MLE is $$Var(\hat{\lambda}) = \frac{1}{n * I_{exp}(\lambda)} = \frac{1}{n * -E[-\frac{1}{\lambda^2}]}  = \frac{\lambda^2}{n}$$ which means the mean squared error of the MLE is $$MSE[\hat{\lambda}] = \frac{\lambda^2}{n} + (\frac{\lambda}{n-1})^2 $$

## MLE Distributions and Consistiency
Given that the MLE estimator is asymptotically unbiased and $\lim\limits_{n \to \infty} Var({\hat{\lambda_n}}) = 0$, then $\hat{\lambda}_{MLE}$ is consistient. 
```{r}
library(gridExtra)
n <- c(10, 100, 1000, 10000)
lambda <- 1.2
num_sims <- 1000

MLEs <- matrix(data = NA, length(n), num_sims)
for (i in 1:length(n)){
  for (j in 1:num_sims) {
    MLEs[[i,j]] <- 1/mean(rexp(n[i], lambda))
  }
}

MLEs <- data.frame(t(MLEs))

p1<- ggplot(data=MLEs, aes(x=X1)) +
  geom_histogram(color="black", fill="dodgerblue", alpha = 0.7, bins=15) +
  labs(title="Distribuion of MLEs for n=10", x=TeX("$\\hat{\\lambda}_{MLE}"), y="Frequency")

p2<- ggplot(data=MLEs, aes(x=X2)) +
  geom_histogram(color="black", fill="dodgerblue", alpha = 0.7, bins=15) +
  labs(title="Distribuion of MLEs for n=100", x=TeX("$\\hat{\\lambda}_{MLE}"), y="Frequency")

p3<- ggplot(data=MLEs, aes(x=X3)) +
  geom_histogram(color="black", fill="dodgerblue", alpha = 0.7, bins=15) +
  labs(title="Distribuion of MLEs for n=1000", x=TeX("$\\hat{\\lambda}_{MLE}"), y="Frequency")

p4<- ggplot(data=MLEs, aes(x=X4)) +
  geom_histogram(color="black", fill="dodgerblue", alpha = 0.7, bins=15) +
  labs(title="Distribuion of MLEs for n=10000", x=TeX("$\\hat{\\lambda}_{MLE}"), y="Frequency")



grid.arrange(p1,p2,p3,p4, ncol=2)
```

## MSE
```{r}
n <- 100
lambdas <- seq(0.1, 1.5, 0.05)
MLE_MSE <- (lambdas^2/n) + (lambdas/(n-1))^2
MSEs <- data.frame(lambdas,MLE_MSE)

p7 <- ggplot(MSEs) +
  geom_line(aes(lambdas, MLE_MSE,), color="dodgerblue") + 
  labs(x=TeX("$\\lambda$"), y="MSE", title="Compare MSE (n=100)")

n <- 1000
MLE_MSE <- (lambdas^2/n) + (lambdas/(n-1))^2
MSEs2 <- data.frame(lambdas,MLE_MSE)

p8 <- ggplot(MSEs2) +
  geom_line(aes(lambdas, MLE_MSE,), color="dodgerblue") + 
  ylim(0,0.02) +
  labs(x=TeX("$\\lambda$"), y="MSE", title="Compare MSE (n=1000)")

grid.arrange(p7,p8,ncol=2)
```

